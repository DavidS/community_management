<html>
<title>PRs that require review</title>
<head>
<script src='./web_libraries/jquery.min.js' type='text/javascript'></script>
<script src='./web_libraries/sorttable.js'></script><link rel='stylesheet' href='./web_libraries/bootstrap.min.css'>
<script src='./web_libraries/DataTables/datatables.js'></script><link rel='stylesheet' href='./web_libraries/DataTables/datatables.css'>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="text/javascript">
  $.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var min = parseInt( $('#min').val(), 10 );
        var max = parseInt( $('#max').val(), 10 );
        var age = parseFloat( data[7] ) || 0; // use data for the age column
 
        if ( ( isNaN( min ) && isNaN( max ) ) ||
             ( isNaN( min ) && age <= max ) ||
             ( min <= age   && isNaN( max ) ) ||
             ( min <= age   && age <= max ) )
        {
            return true;
        }
        return false;
    }
);
  $(document).ready(function() {
    var table = $('#reviews').DataTable();
     
    // Event listener to the two range filtering inputs to redraw on input
    $('#min, #max').keyup( function() {
        table.draw();
    } );
} );
 
    $(document).ready(function() {
    // Setup - add a text input to each footer cell
    $('#reviews thead tr td').each( function () {
        var title = $(this).text();
        $(this).append( '<input class="something" type="text" placeholder="Search '+title+'" />' );
    } );
 
    // DataTable
    var table = $('#reviews').DataTable();
 
    // Apply the search


    table.columns().every( function () {
        var that = this;
        $( 'input.something', this.header() ).on( 'keyup change clear', function () {
            if ( that.search() !== this.value ) {
                that
                    .search( this.value )
                    .draw();  
            }
        } );
    } );

    $( 'input.something' ).on('click', function(e){
      e.stopPropagation();
      e.preventDefault();
    })
} );
</script>
<style>
   .button {
         background-color: #ddd;
         border: none;
         color: white;
         padding: 10px 20px;
         text-align: center;
         text-decoration: none;
         display: inline-block;
         font-size: 20px;
         margin: 4px 2px;
         cursor: pointer;
         }


         .btn {
  border: none;
  background-color: inherit;
  padding: 10px 10px;
  font-size: 14px;
  cursor: pointer;
  display: inline-block;
}

.btn:hover {background: #eee;}

.minim_button {color: grey;}

.maxim_button {color: grey;}


#reviews {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
   font-size: 18px;
  border-collapse: collapse;
  width: 50%;


}
.word_break {
  word-break: break-all;
  width: auto;
}
#reviews td, #reviews th {
  border: 1px solid #ddd;
  padding: 8px;
}

#reviews tr:nth-child(even){background-color: #f2f2f2;

 }

#reviews tr:hover {background-color: #ddd;
 }

#reviews th {
  padding-top: 9px;
  padding-bottom: 9px;
  text-align: left;
  background-color: #cfcfcf;
  color: black;
 
}
  </style>
</head>
<body>
<h1>Modules PRs that require review</h1>
 <a href="https://puppetlabs.github.io/community_management/report30.html" class="button">30 Days</a>
 <a href="https://puppetlabs.github.io/community_management/report60.html" class="button">60 Days</a>
 <a href="https://puppetlabs.github.io/community_management/report90.html" class="button">90 Days</a>
 <table border="0" cellspacing="3" cellpadding="3">
        <tbody><tr>
            <button class="btn minim_button">Minimum:</button>
            <button><input type="text" id="min" name="min"></button>  
            <button class="btn maxim_button">Maximum:</button>
            <button><input type="text" id="max" name="max"></button>
    </tbody></table><table id="example" class="display" style="width:100%">
<table border='1' id='reviews' style='width:100%' class='sortable table table-hover'> 
<tr>

  
    <td> repo</td> 
   

   

  
    <td> pr</td> 
   

  
    <td> age</td> 
   

  
    <td> owner</td> 
   

  
    <td> title</td> 
   

  
    <td> last_comment</td> 
   

  
    <td> by</td> 
   

  
    <td> age_comment</td> 
   

  
    <td> num_comments</td> 
   

  
    <td> no_comment_from_puppet</td> 
   

  
    <td> last_comment_mentions_puppet</td> 
   

</tr>


  <tr>
  
  
      <td><a target ="_blank" href='https://github.com/puppetlabs/puppetlabs-apache'>puppetlabs-apache</a></td>
  
  
  
      
  
  
  
      <td><a target ="_blank" href='https://github.com/puppetlabs/puppetlabs-apache/pull/2021'>2021</a></td>
  
  
  
      
        <td>51</td>
      
  
  
  
      
        <td>farebers</td>
      
  
  
  
      
        <td>MODULES-10586 Centos 8: wrong package used to install mod_authnz_ldap</td>
      
  
  
  
      
        <td>Hi @farebers,

Firstly, thank you for the fix and highlighting the gap in the test coverage to capture this. As you pointed out, the unit tests did not catch this failure. We can certainly extend `spec/classes/mod/authnz_ldap_spec.rb` to verify that we are using the correct package name on RHEL systems based on their major versions, but, unfortunately this will not catch the failure until the manifest is actually compiled on an OS. 

I think the best thing is to to add an acceptance test for this particular scenario in a file called `spec/acceptance/mod_authnz_ldap_spec.rb`, something along the lines of this:

```ruby
require 'spec_helper_acceptance'
apache_hash = apache_settings_hash

describe 'apache::mod_authnz_ldap' do
  context 'Default mod_authnz_ldap module installation' do
    pp =  6
          it { is_expected.to contain_package('mod_ldap')}
        end
```

...but there's a few issues I'm running in to with this approach.

I think the path of least resistance would be to add an acceptance test, similar to above. Let me know if I can be of any further help.</td>
      
  
  
  
      
        <td>sanfrancrisko</td>
      
  
  
  
      
        <td>49</td>
      
  
  
  
      
        <td>1</td>
      
  
  
  
      
        <td>false</td>
      
  
  
  
      
        <td>false</td>
      
  
  
  </tr>

  <tr>
  
  
      <td><a target ="_blank" href='https://github.com/puppetlabs/puppetlabs-reboot'>puppetlabs-reboot</a></td>
  
  
  
      
  
  
  
      <td><a target ="_blank" href='https://github.com/puppetlabs/puppetlabs-reboot/pull/246'>246</a></td>
  
  
  
      
        <td>57</td>
      
  
  
  
      
        <td>sanfrancrisko <span class='label label-primary'>iac</span> <span class='label label-warning'>puppet</span></td>
      
  
  
  
      
        <td>{BLOCKED} (IAC-140) Add release workflow config for GHActions</td>
      
  
  
  
      
        <td>Currently investigating an issue that is holding up the merge of this. On Github Actions, the [last few runs](https://github.com/puppetlabs/puppetlabs-reboot/runs/685479862) have shown that the `bundle exec rake spec` command is hanging. After some help debugging from @DavidS , it appears as though the GHAction runner is emulating an interactive shell and as part of that, trying to send an empty file / data to STDIN.

We were able to reproduce the issue on this module by piping `/dev/null` to the `spec` Rake task:

```
bundle exec rake spec '
# ./spec/unit/task/init_spec.rb:2:in `require_relative'
# ./spec/unit/task/init_spec.rb:2:in `'
Run options: exclude {:bolt=>true}

Deprecation Warnings:

puppetlabs_spec_helper: defaults `mock_with` to `:mocha`. See https://github.com/puppetlabs/puppetlabs_spec_helper#mock_with to choose a sensible value for you


If you need more of the backtrace for any of these deprecations to
identify where to make the necessary changes, you can configure
`config.raise_errors_for_deprecations!`, and it will turn the
deprecation warnings into errors, giving you the full backtrace.

1 deprecation warning total

Finished in 0.00003 seconds (files took 1.59 seconds to load)
0 examples, 0 failures, 1 error occurred outside of examples

/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby -I/Users/ciaran.mccrisken/gems/gems/rspec-core-3.9.2/lib:/Users/ciaran.mccrisken/gems/gems/rspec-support-3.9.3/lib /Users/ciaran.mccrisken/gems/gems/rspec-core-3.9.2/exe/rspec --pattern spec/\{aliases,classes,defines,functions,hosts,integration,plans,tasks,type_aliases,types,unit\}/\*\*/\*_spec.rb failed

```

In the [following lines in `tasks/init.rb`](https://github.com/puppetlabs/puppetlabs-reboot/blob/f7bcf65c68742588d2ca7c956c8ee6de389e598a/tasks/init.rb#L91-L92) we are getting `true` back to the following query on line 91:
```
unless STDIN.tty?
```
and then subsequently, an explosion on the `JSON.parse(STDIN.read)` as `STDIN.read` is not returning a valid JSON-formatted task to execute.

We have two problems here:

1. From the perspective of the application running in the context of a GHActions runner, it should not have a TTY available. See [this issue](https://github.com/actions/runner/issues/241) raised with Github that shows `echo "$(tty)"` run in the context of the GHA runner returns `not a tty`. However, it does seem to be providing an empty file on STDIN, which could very well affect other modules across the org if there's nothing handling that scenario.

2. For this module, we should probably be much more robust in how we handle the `STDIN` piped task to execute. We should verify that it's valid JSON before instantiating a new `Reboot::Task` with it. Perhaps with a `begin; rescue JSON::ParserError` wrapping the `Reboot::Task.new` call. The following adjustment will work when running `bundle exec rake spec  'queued',
      'timeout' => reboot.timeout,
    }
    JSON.dump(result, STDOUT)
  rescue JSON::ParserError
    Puppet.warning('Task provided on STDIN is invalid JSON')
  end
end
```</td>
      
  
  
  
      
        <td>sanfrancrisko</td>
      
  
  
  
      
        <td>31</td>
      
  
  
  
      
        <td>2</td>
      
  
  
  
      
        <td>false</td>
      
  
  
  
      
        <td>true</td>
      
  
  
  </tr>
 
</table>
</body>
</html>
